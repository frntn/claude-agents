# Claude Agents Repository

A collection of Claude agents built using the official **Claude Agent SDK** for Python.

## Repository Structure

```
claude-agents/
‚îú‚îÄ‚îÄ agents/                      # Individual agent implementations
‚îÇ   ‚îú‚îÄ‚îÄ agent-template/          # Template for new agents
‚îÇ   ‚îú‚îÄ‚îÄ example-agent/           # Example agent with custom tools
‚îÇ   ‚îú‚îÄ‚îÄ azure-fsi-landingzone/   # Mono-agent for FSI Landing Zones
‚îÇ   ‚îî‚îÄ‚îÄ azure-fsi-landingzone-squad/ # Multi-agent squad for FSI
‚îú‚îÄ‚îÄ shared/                      # Shared utilities and base classes
‚îÇ   ‚îú‚îÄ‚îÄ agents.py               # BaseClaudeAgent and InteractiveAgent classes
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # Common utility functions
‚îÇ   ‚îî‚îÄ‚îÄ configs/                # Shared configuration files
‚îú‚îÄ‚îÄ docs/                       # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ getting-started.md      # Getting started guide
‚îÇ   ‚îú‚îÄ‚îÄ agents/                 # Agent development docs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ overview.md         # Agent overview and catalog
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ creating-agents.md  # How to create agents
‚îÇ   ‚îî‚îÄ‚îÄ azure-fsi/              # Azure FSI Landing Zone docs
‚îÇ       ‚îú‚îÄ‚îÄ README.md           # FSI agents overview
‚îÇ       ‚îú‚îÄ‚îÄ architecture/       # Architecture documentation
‚îÇ       ‚îî‚îÄ‚îÄ guides/             # Usage guides
‚îú‚îÄ‚îÄ scripts/                    # Build and deployment scripts
‚îî‚îÄ‚îÄ tests/                      # Test files
```

## Features

‚ú® **Built with Claude Agent SDK**: Uses the official Python SDK for Claude agents
üõ†Ô∏è **Custom Tools**: Easy creation of custom MCP tools using decorators
ü§ñ **Interactive Agents**: Ready-to-use interactive conversation interfaces
‚öôÔ∏è **Configuration Management**: YAML-based configuration with environment overrides
üìù **Comprehensive Logging**: Structured logging with file and console output
üéØ **Type Safety**: Full type hints and validation

---

## ‚ö†Ô∏è Determinism & Production Readiness

**CRITICAL INFORMATION FOR BANKING/FSI INFRASTRUCTURE TEAMS**

This section clarifies what is deterministic (reproducible) and what is non-deterministic (variable) when using these agents. Understanding this distinction is essential for production deployments in regulated environments.

### What is DETERMINISTIC ‚úÖ

The following components produce **identical, reproducible output** across multiple runs:

#### 1. Infrastructure Templates (Bicep/ARM)
- **Template Generation Methods**: All Bicep templates are generated by **hardcoded Python functions** (`_generate_hub_vnet_bicep()`, `_generate_spoke_vnet_bicep()`, etc.)
- **Azure Verified Modules (AVM)**: Templates use Microsoft-validated modules with **pinned semantic versions**
  - Virtual Network: `br/public:avm/res/network/virtual-network:0.1.8`
  - Azure Firewall: `br/public:avm/res/network/azure-firewall:0.3.0`
  - Key Vault: `br/public:avm/res/key-vault/vault:0.6.2`
  - Storage Account: `br/public:avm/res/storage/storage-account:0.9.1`
- **Validation**: All templates pass `az bicep build` validation (see `agents/azure-fsi-landingzone/test_avm_templates.py`)

**Proof of Determinism**:
```bash
cd agents/azure-fsi-landingzone
python test_avm_templates.py
# Output: 5/5 templates valid (identical across runs)
```

#### 2. Template Content
If you call the same template generation tool twice, you get **byte-for-byte identical** Bicep code:
```bash
# Run 1: Generate hub-vnet template
python -c "from agent import AzureFSILandingZoneAgent; a = AzureFSILandingZoneAgent('.'); print(a._generate_hub_vnet_bicep())" > run1.bicep

# Run 2: Generate hub-vnet template again
python -c "from agent import AzureFSILandingZoneAgent; a = AzureFSILandingZoneAgent('.'); print(a._generate_hub_vnet_bicep())" > run2.bicep

# Verify: Files are identical
diff run1.bicep run2.bicep
# Exit code: 0 (no differences)
```

#### 3. Azure Deployment Behavior
Once templates are generated, Azure Resource Manager deployments are **fully deterministic** using standard Azure CLI/PowerShell:
```bash
az deployment group create \
  --resource-group fsi-hub-rg \
  --template-file templates/hub-vnet.bicep
# Same template = Same infrastructure every time
```

### What is NON-DETERMINISTIC ‚ùå

The following components produce **variable output** across multiple runs:

#### 1. Conversational Workflow
The AI agent's conversation flow is **non-deterministic**:
- **Prompt**: "Deploy an FSI Landing Zone"
  - **Run 1**: Agent might generate Ring 0 only (minimal foundation)
  - **Run 2**: Agent might generate Ring 0 + Ring 1 + Ring 2 (full deployment)
  - **Run 3**: Agent might ask clarifying questions first

#### 2. Recommendations & Guidance
- The agent's architectural recommendations vary based on context
- Troubleshooting paths differ between runs
- Explanations and documentation suggestions change

#### 3. Tool Selection Order
- The AI decides which tools to call and in what order
- Multiple valid approaches may be taken for the same request

### Production Deployment Strategies

For **regulated banking/FSI environments**, we recommend the following approach:

#### ‚úÖ Recommended: Template Generation + IaC Pipeline

**Phase 1: Template Generation (Agent-Assisted)**
```bash
cd agents/azure-fsi-landingzone

# Generate all required templates upfront
python test_avm_templates.py

# Templates are now in templates/ directory
ls -la templates/
# hub-vnet.bicep
# spoke-vnet.bicep
# key-vault.bicep
# storage.bicep
# policy-assignment.bicep
```

**Phase 2: Version Control (Auditable)**
```bash
# Store generated templates in Git
mkdir -p golden-templates/v1.0/
cp templates/*.bicep golden-templates/v1.0/

git add golden-templates/
git commit -m "Add validated FSI landing zone templates v1.0"
git tag v1.0-fsi-templates

# Peer review via pull request
# Security review
# Compliance review
```

**Phase 3: Automated Deployment (Deterministic)**
```bash
# Deploy via Azure DevOps / GitHub Actions
# NO AI involved in production deployments

az deployment group create \
  --resource-group fsi-hub-rg \
  --template-file golden-templates/v1.0/hub-vnet.bicep \
  --parameters @parameters.json
```

#### ‚ùå Not Recommended: Live AI-Driven Deployments

Do **NOT** use the interactive agent for direct production deployments:
```bash
# ‚ùå AVOID THIS IN PRODUCTION
python agent.py
> "Deploy FSI Landing Zone to production"  # Non-deterministic!
```

**Why?**: Each run may produce different deployment scopes, making audit trails inconsistent.

### Use Cases by Environment

| Environment | Agent Usage | Template Source | Deployment Method |
|-------------|-------------|-----------------|-------------------|
| **Production** | ‚ùå No live agent | ‚úÖ Git-stored golden templates | ‚úÖ Azure DevOps/GitHub Actions |
| **Staging** | ‚ö†Ô∏è Limited (validation only) | ‚úÖ Git-stored templates | ‚úÖ IaC pipeline |
| **Development** | ‚úÖ Interactive agent | ‚úÖ Agent-generated | ‚ö†Ô∏è Manual with review |
| **Sandbox/POC** | ‚úÖ Full agent use | ‚úÖ Agent-generated | ‚úÖ Agent-assisted |

### Validation & Testing

All templates are validated through:

1. **Syntax Validation**: `az bicep build --file <template>.bicep`
2. **Automated Tests**: `agents/azure-fsi-landingzone/test_avm_templates.py`
3. **What-If Analysis**: `az deployment group what-if` before production deployment
4. **AVM Module Guarantees**: Microsoft-validated, semantically versioned modules
5. **Squad Mode Validator**: Bicep linting via dedicated validator specialist agent

### Summary for Banking Infrastructure Teams

| Aspect | Status | Notes |
|--------|--------|-------|
| **Template Code** | ‚úÖ Deterministic | Hardcoded Python methods with pinned AVM versions |
| **Template Output** | ‚úÖ Deterministic | Byte-for-byte identical across runs |
| **Azure Deployments** | ‚úÖ Deterministic | Standard ARM/Bicep deployment behavior |
| **Conversational Flow** | ‚ùå Non-Deterministic | AI decides scope, order, recommendations |
| **Audit Trail** | ‚úÖ Possible | Store templates in Git, deploy via IaC pipelines |
| **Production Safety** | ‚úÖ Yes | When using recommended template generation + IaC approach |

**Bottom Line**: This agent is a **deterministic template generator** with a **non-deterministic conversational interface**. For production FSI deployments, use the agent to generate and validate templates, then deploy via standard IaC pipelines.

---

## AI Coding Agent Support

This repository includes **[AGENTS.md](AGENTS.md)** - a standardized guidance file for AI coding agents following the [agents.md](https://agents.md) open format.

**What's included:**
- Common development commands (setup, testing, running agents)
- High-level architecture overview (agent hierarchy, squad mode orchestration)
- Azure FSI Landing Zone specifics (ring-based deployment, compliance)
- Testing patterns and key development practices

**Compatibility:**
- ‚úÖ **AGENTS.md** - Works with Gemini CLI, Codex CLI, Cursor, and other agents supporting the standard
- ‚úÖ **CLAUDE.md** - Symlinked to AGENTS.md for Claude Code compatibility (until [native support](https://github.com/anthropics/claude-code/issues/6235) is added)

When using AI coding assistants with this repository, they'll automatically read AGENTS.md for project-specific context and instructions.

## Quick Start

1. **Install [uv](https://docs.astral.sh/uv/) (once) and run setup**
   ```bash
   git clone <repository-url>
   cd claude-agents
   ./scripts/setup.sh
   source .venv/bin/activate  # Or use `uv run <command>` without activating
   ```

2. **Configure your API key**
   ```bash
   cp .env.example .env
   # Edit .env and add your ANTHROPIC_API_KEY
   ```

3. **Try the example agent**
   ```bash
   cd agents/example-agent
   python agent.py
   ```

4. **Create your first custom agent**
   ```bash
   cp -r agents/agent-template agents/my-first-agent
   cd agents/my-first-agent
   # Edit config.yaml and agent.py
   python agent.py
   ```

### Dependency Management with uv
- On first run, the setup script resolves the newest compatible packages from `requirements.txt` and writes `uv.lock`.
- Subsequent installs automatically use `uv.lock` for reproducible versions.
- Refresh the lock file whenever you want to upgrade:
  ```bash
  uv pip compile requirements.txt -o uv.lock
  ```
- Commit `uv.lock` so teammates and CI get identical environments.

## Makefile Tasks

Common workflows are exposed via the root `Makefile`:

- Run `make help` to list available commands.
- Use `make setup` for the bootstrap script.
- Run `make test` for the primary pytest suite in `tests/`.
- Run `make test-azure-fsi` to execute the Azure FSI Landing Zone checks, including AVM template validation.
- Override `AZURE_BICEP_BUILD_TIMEOUT` when running `make test-azure-fsi` if `az bicep build` needs more than the default 120 seconds, and set `AZURE_BICEP_KEEP_TEMPLATES=1` to keep rendered `.bicep`/`.json` files for debugging.

## Available Agents

### Templates & Examples
- **üèóÔ∏è [agent-template](agents/agent-template/)**: Complete template for creating new agents with custom tools
- **üéØ [example-agent](agents/example-agent/)**: Feature-rich example showing Claude Agent SDK capabilities

### Azure FSI Landing Zone Agent
- **üè¶ [azure-fsi-landingzone](docs/azure-fsi/)**: Azure FSI Landing Zone deployment agent with two operational modes:
  - **Solo Mode** (default): Quick template generation and simple deployments
  - **Squad Mode** (`--squad` flag): Multi-agent collaboration with specialist expertise (Architect, DevOps, Security, Network)

**Choose your mode:**
- **Solo Mode**: Best for quick template generation and simple deployments
- **Squad Mode**: Best for production readiness, compliance reviews, and expert analysis

See the [Azure FSI Documentation](docs/azure-fsi/) for detailed comparison and guides.

### Compliance Tools
- **üìã [azure-compliance-checker](agents/azure-compliance-checker/)**: Automated compliance validation for French FSI regulations (ACPR, CRD IV/CRR, LCB-FT, RGPD, ISO 27001, DORA, NIS2)

## Requirements

- **Python 3.10+**
- **Node.js 18+** (for Claude Code CLI)
- **Claude Code CLI v2.0.1+**: `npm install -g @anthropic-ai/claude-code@latest` ‚ö†Ô∏è **REQUIRED**
- **uv 0.4+** (Python packaging tool)
- **Claude Agent SDK v0.1.0+** (install with `uv pip sync uv.lock` or bootstrap with `uv pip install -r requirements.txt`)
- **Anthropic API key** (from https://console.anthropic.com)

**Important**: Claude Code CLI v2.0.1+ is required for the claude-agent-sdk to work. Version 1.x is not compatible.

## Key Components

### BaseClaudeAgent
Base class providing:
- Claude Agent SDK integration
- Configuration management  
- Custom tool support
- Async context manager support

### InteractiveAgent
Extends BaseClaudeAgent with:
- Interactive conversation loops
- Message display formatting
- Command-line interface

### Custom Tools
Create custom tools using the `@tool` decorator:

```python
from claude_agent_sdk import tool

@tool("my_tool", "Description of what it does", {"param": str})
async def my_custom_tool(args):
    return {"content": [{"type": "text", "text": "Result"}]}
```

## Documentation

### Getting Started
- **[Getting Started Guide](docs/getting-started.md)**: Repository setup and environment configuration
- **[Agent Overview](docs/agents/overview.md)**: Learn about Claude agents and available implementations
- **[Creating Agents](docs/agents/creating-agents.md)**: Comprehensive guide to building custom agents

### Specialized Documentation
- **[Azure FSI Landing Zone](docs/azure-fsi/)**: Complete documentation for FSI Landing Zone agents
  - Architecture guides (Ring-based deployment, Multi-agent squad)
  - Quick start guides (Mono-agent, Squad)
  - Deployment workflows and best practices

### Reference
- **[Repository Architecture](ARCHITECTURE.md)**: Overall repository architecture
- **[Roadmap](ROADMAP.md)**: Future plans and features

## Contributing

1. Use the `agent-template` as a starting point
2. Follow the established directory structure
3. Add comprehensive documentation (see [docs/agents/creating-agents.md](docs/agents/creating-agents.md))
4. Include tests for custom functionality
5. Use type hints throughout

## License

[Add your license information here]
